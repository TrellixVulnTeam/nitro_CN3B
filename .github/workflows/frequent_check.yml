name: Build, unittest

on: [push]


jobs:
  build:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
        python-version: ['3.7']
        include:
            - os: ubuntu-latest
              build_with: "-G Ninja"
              python_info: ""
            - os: windows-latest
              build_with: "-G Ninja"
              python_info: "-DENABLE_PYTHON=OFF"
    name: ${{ matrix.os }}-${{ matrix.python-version }}
    runs-on: ${{ matrix.os }}
    steps:
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install python dependencies
      run: |
        python3 -m pip install --upgrade pip
        pip install numpy
    - name: Get latest CMake and ninja
      # Using 'latest' branch, the most recent CMake and ninja are installed.
      uses: lukka/get-cmake@latest        # THIS IS THE ONE LINER YOU NEED
    - name: configure
      run: |
        mkdir build
        cd build
        cmake ${{ matrix.build_with }} -DCMAKE_INSTALL_PREFIX=install${{ matrix.os }}-Github -DPYTHON_VERSION=${{ matrix.python-version }} ${{ matrix.python_info }} ..
    - name: make
      run: |
        cd build
        cmake --build . --config Release -j
        cmake --build . --config Release --target install
    - name: test
      run: |
        cd build
        ctest -VV -C Release

