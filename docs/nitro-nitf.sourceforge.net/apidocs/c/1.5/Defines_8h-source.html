<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>NITF: Defines.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">include</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">nitf</a></div>
<h1>Defines.h</h1><a href="Defines_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/* =========================================================================</span>
00002 <span class="comment"> * This file is part of NITRO</span>
00003 <span class="comment"> * =========================================================================</span>
00004 <span class="comment"> * </span>
00005 <span class="comment"> * (C) Copyright 2004 - 2008, General Dynamics - Advanced Information Systems</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> * NITRO is free software; you can redistribute it and/or modify</span>
00008 <span class="comment"> * it under the terms of the GNU Lesser General Public License as published by</span>
00009 <span class="comment"> * the Free Software Foundation; either version 3 of the License, or</span>
00010 <span class="comment"> * (at your option) any later version.</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
00013 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00014 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00015 <span class="comment"> * GNU Lesser General Public License for more details.</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> * You should have received a copy of the GNU Lesser General Public </span>
00018 <span class="comment"> * License along with this program; if not, If not, </span>
00019 <span class="comment"> * see &lt;http://www.gnu.org/licenses/&gt;.</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> */</span>
00022 
00023 <span class="preprocessor">#ifndef __NITF_DEFINES_H__</span>
00024 <span class="preprocessor"></span><span class="preprocessor">#define __NITF_DEFINES_H__</span>
00025 <span class="preprocessor"></span>
00026 <span class="comment">/* The version of the NITF library */</span>
<a name="l00027"></a><a class="code" href="Defines_8h.html#a0">00027</a> <span class="preprocessor">#define NITF_LIB_VERSION    "1.5"</span>
00028 <span class="preprocessor"></span>
00029 
00030 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00031"></a><a class="code" href="Defines_8h.html#a1">00031</a> <span class="preprocessor"></span><span class="preprocessor">#   define NITF_C extern "C"</span>
<a name="l00032"></a><a class="code" href="Defines_8h.html#a2">00032</a> <span class="preprocessor"></span><span class="preprocessor">#   define NITF_GUARD {</span>
<a name="l00033"></a><a class="code" href="Defines_8h.html#a3">00033</a> <span class="preprocessor"></span><span class="preprocessor">#   define NITF_ENDGUARD }</span>
<a name="l00034"></a><a class="code" href="Defines_8h.html#a4">00034</a> <span class="preprocessor"></span><span class="preprocessor">#   define NITF_BOOL bool</span>
00035 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#   define NITF_C</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#   define NITF_GUARD</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#   define NITF_ENDGUARD</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#   define NITF_BOOL int</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00041 <span class="preprocessor"></span>
00042 <span class="preprocessor">#ifdef WIN32</span>
00043 <span class="preprocessor"></span><span class="comment">/*  Negotiate the meaning of NITFAPI, NITFPROT (for public and protected)  */</span>
00044 <span class="preprocessor">#      if defined(NITF_MODULE_EXPORTS)</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#          define NITFAPI(RT)  NITF_C __declspec(dllexport) RT</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#          define NITFPROT(RT) NITF_C __declspec(dllexport) RT</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#      else</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#          define NITFAPI(RT)  NITF_C __declspec(dllimport) RT</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#          define NITFPROT(RT) NITF_C __declspec(dllexport) RT</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#      endif</span>
00051 <span class="preprocessor"></span><span class="comment">/*  String conversion, on windows  */</span>
00052 <span class="preprocessor">#      define  NITF_ATO32(A) strtol(A, (char **)NULL, 10)</span>
00053 <span class="preprocessor"></span><span class="preprocessor">#      define  NITF_ATOU32(A) strtoul(A, (char **)NULL, 10)</span>
00054 <span class="preprocessor"></span><span class="preprocessor">#      define  NITF_ATO64(A) _atoi64(A)</span>
00055 <span class="preprocessor"></span><span class="preprocessor">#      define  NITF_SNPRINTF _snprintf</span>
00056 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00057 <span class="preprocessor"></span><span class="comment">/*</span>
00058 <span class="comment">*  NITFAPI and NITFPROT don't mean as much on Unix since they</span>
00059 <span class="comment">*  Don't try and mangle functions for you in C</span>
00060 <span class="comment">*/</span>
<a name="l00061"></a><a class="code" href="Defines_8h.html#a5">00061</a> <span class="preprocessor">#      define  NITFAPI(RT)  NITF_C RT</span>
<a name="l00062"></a><a class="code" href="Defines_8h.html#a6">00062</a> <span class="preprocessor"></span><span class="preprocessor">#      define  NITFPROT(RT) NITF_C RT</span>
<a name="l00063"></a><a class="code" href="Defines_8h.html#a7">00063</a> <span class="preprocessor"></span><span class="preprocessor">#      define  NITF_ATO32(A) strtol(A, (char **)NULL, 10)</span>
<a name="l00064"></a><a class="code" href="Defines_8h.html#a8">00064</a> <span class="preprocessor"></span><span class="preprocessor">#      define  NITF_ATOU32(A) strtoul(A, (char **)NULL, 10)</span>
00065 <span class="preprocessor"></span><span class="preprocessor">#      if defined(__aix__)</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#          define  NITF_ATO64(A) strtoll(A, 0, 0)</span>
00067 <span class="preprocessor"></span><span class="preprocessor">#      else</span>
<a name="l00068"></a><a class="code" href="Defines_8h.html#a9">00068</a> <span class="preprocessor"></span><span class="preprocessor">#          define  NITF_ATO64(A) atoll(A)</span>
00069 <span class="preprocessor"></span><span class="preprocessor">#      endif</span>
<a name="l00070"></a><a class="code" href="Defines_8h.html#a10">00070</a> <span class="preprocessor"></span><span class="preprocessor">#      define NITF_SNPRINTF snprintf</span>
00071 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00072 <span class="preprocessor"></span><span class="comment">/*</span>
00073 <span class="comment"> *  This section describes a set of macros to help with</span>
00074 <span class="comment"> *  C++ compilation.  The 'extern C' set is required to</span>
00075 <span class="comment"> *  prevent name-mangling.</span>
00076 <span class="comment"> *</span>
00077 <span class="comment"> *  We also define a boolean according to the language,</span>
00078 <span class="comment"> *  since it is obnoxious to use an int when C++ has a</span>
00079 <span class="comment"> *  perfectly good one already.</span>
00080 <span class="comment"> */</span>
00081 
<a name="l00082"></a><a class="code" href="Defines_8h.html#a11">00082</a> <span class="preprocessor">#define NITF_CXX_GUARD     NITF_C NITF_GUARD</span>
<a name="l00083"></a><a class="code" href="Defines_8h.html#a12">00083</a> <span class="preprocessor"></span><span class="preprocessor">#define NITF_CXX_ENDGUARD  NITF_ENDGUARD</span>
00084 <span class="preprocessor"></span>
00085 <span class="comment">/*  Private declarations.  */</span>
<a name="l00086"></a><a class="code" href="Defines_8h.html#a13">00086</a> <span class="preprocessor">#define NITFPRIV(RT) static RT</span>
00087 <span class="preprocessor"></span>
00088 <span class="comment">/*  Negotiate the 'context'  */</span>
<a name="l00089"></a><a class="code" href="Defines_8h.html#a14">00089</a> <span class="preprocessor">#define NITF_FILE __FILE__</span>
<a name="l00090"></a><a class="code" href="Defines_8h.html#a15">00090</a> <span class="preprocessor"></span><span class="preprocessor">#define NITF_LINE __LINE__</span>
00091 <span class="preprocessor"></span><span class="preprocessor">#if defined(__GNUC__)</span>
00092 <span class="preprocessor"></span><span class="preprocessor">#    define NITF_FUNC __PRETTY_FUNCTION__</span>
00093 <span class="preprocessor"></span><span class="preprocessor">#elif __STDC_VERSION__ &lt; 199901</span>
<a name="l00094"></a><a class="code" href="Defines_8h.html#a16">00094</a> <span class="preprocessor"></span><span class="preprocessor">#    define NITF_FUNC "unknown function"</span>
00095 <span class="preprocessor"></span><span class="preprocessor">#else </span><span class="comment">/* Should be c99 */</span>
00096 <span class="preprocessor">#    define NITF_FUNC __func</span>
00097 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00098 <span class="preprocessor"></span>
00099 
<a name="l00108"></a><a class="code" href="Defines_8h.html#a17">00108</a> <span class="preprocessor">#define NITF_DECLARE_PLUGIN(_Tre) \</span>
00109 <span class="preprocessor">    static char *ident[] = { \</span>
00110 <span class="preprocessor">        NITF_PLUGIN_TRE_KEY, \</span>
00111 <span class="preprocessor">        #_Tre, \</span>
00112 <span class="preprocessor">        NULL \</span>
00113 <span class="preprocessor">    }; \</span>
00114 <span class="preprocessor">    NITFAPI(char**) _Tre##_init(nitf_Error* error){return ident;} \</span>
00115 <span class="preprocessor">    NITFAPI(void) _Tre##_cleanup(void){}\</span>
00116 <span class="preprocessor">    NITFAPI(nitf_TREDescriptionSet*) _Tre##_getDescriptions(void){return &amp;descriptionSet;}\</span>
00117 <span class="preprocessor">    NITFAPI(void) _Tre##_setDescription(nitf_TRE* tre, nitf_Error* error)\</span>
00118 <span class="preprocessor">    {\</span>
00119 <span class="preprocessor">        nitf_TREDescriptionSet *descriptions = NULL;\</span>
00120 <span class="preprocessor">        nitf_TREDescriptionInfo *infoPtr = NULL;\</span>
00121 <span class="preprocessor">        int numDescriptions = 0;\</span>
00122 <span class="preprocessor">        if (!tre)\</span>
00123 <span class="preprocessor">        {\</span>
00124 <span class="preprocessor">            nitf_Error_init(error, "setDescription -&gt; invalid tre object",\</span>
00125 <span class="preprocessor">                            NITF_CTXT, NITF_ERR_INVALID_PARAMETER);\</span>
00126 <span class="preprocessor">            return;\</span>
00127 <span class="preprocessor">        }\</span>
00128 <span class="preprocessor">        descriptions = _Tre##_getDescriptions();\</span>
00129 <span class="preprocessor">        if (!descriptions)\</span>
00130 <span class="preprocessor">        {\</span>
00131 <span class="preprocessor">            nitf_Error_init(error, "TRE Description Set is NULL",\</span>
00132 <span class="preprocessor">                            NITF_CTXT, NITF_ERR_INVALID_OBJECT);\</span>
00133 <span class="preprocessor">            return;\</span>
00134 <span class="preprocessor">        }\</span>
00135 <span class="preprocessor">        tre-&gt;descrip = NULL; </span><span class="comment">/* set to NULL */</span>\
00136         <span class="comment">/* first try to match against the length */</span>\
00137         if (tre-&gt;length &gt; NITF_TRE_DEFAULT_LENGTH)\
00138         {\
00139             infoPtr = descriptions-&gt;descriptions;\
00140             while (infoPtr &amp;&amp; (infoPtr-&gt;description != NULL))\
00141             {\
00142                 if (infoPtr-&gt;lengthMatch == tre-&gt;length)\
00143                 {\
00144                     tre-&gt;descrip = infoPtr-&gt;description;\
00145                     break;\
00146                 }\
00147                 infoPtr++;\
00148             }\
00149         }\
00150         <span class="comment">/* now, try to assign the default */</span>\
00151         if (!tre-&gt;descrip)\
00152         {\
00153             infoPtr = descriptions-&gt;descriptions;\
00154             while (infoPtr &amp;&amp; (infoPtr-&gt;description != NULL))\
00155             {\
00156                 if (numDescriptions == descriptions-&gt;defaultIndex)\
00157                 {\
00158                     tre-&gt;descrip = infoPtr-&gt;description;\
00159                     if (tre-&gt;length == NITF_TRE_DEFAULT_LENGTH &amp;&amp;\
00160                         infoPtr-&gt;lengthMatch != NITF_TRE_DESC_NO_LENGTH)\
00161                         tre-&gt;length = infoPtr-&gt;lengthMatch;\
00162                     break;\
00163                 }\
00164                 numDescriptions++;\
00165                 infoPtr++;\
00166             }\
00167         }\
00168         if (!tre-&gt;descrip)\
00169         {\
00170             nitf_Error_init(error, "TRE Description is NULL",\
00171                             NITF_CTXT, NITF_ERR_INVALID_OBJECT);\
00172             return;\
00173         }\
00174     }\
00175     NITFAPI(int) _Tre##_handler(nitf_IOHandle io,nitf_TRE* tre,nitf_Record* rec,nitf_Error* error)\
00176     { \
00177         int ok; \
00178         char *data = NULL; \
00179         NITF_BOOL success; \
00180         if (!tre) {goto CATCH_ERROR;} \
00181         _Tre##_setDescription(tre, error); \
00182         if (!tre-&gt;descrip) goto CATCH_ERROR; \
00183         data = (char*)NITF_MALLOC( tre-&gt;length ); \
00184         if (!data) \
00185         { \
00186             nitf_Error_init(error, NITF_STRERROR( NITF_ERRNO ),NITF_CTXT, NITF_ERR_MEMORY );\
00187             goto CATCH_ERROR;\
00188         }\
00189         memset(data, 0, tre-&gt;length);\
00190         success = nitf_TRE_readField(io, data, (int)tre-&gt;length, error);\
00191         if (!success) goto CATCH_ERROR;\
00192         ok = nitf_TRE_parse(tre, data, error);\
00193         NITF_FREE( data );\
00194         data = NULL;\
00195     if (!ok){goto CATCH_ERROR; }\
00196         return NITF_SUCCESS;\
00197     CATCH_ERROR:\
00198         if (data) NITF_FREE(data);\
00199         return NITF_FAILURE;\
00200     }
00201 
<a name="l00208"></a><a class="code" href="Defines_8h.html#a18">00208</a> <span class="preprocessor">#define NITF_DECLARE_SINGLE_PLUGIN(_Tre, _Description) \</span>
00209 <span class="preprocessor">    static nitf_TREDescriptionInfo descriptions[] = { \</span>
00210 <span class="preprocessor">        { #_Tre, _Description, NITF_TRE_DESC_NO_LENGTH }, \</span>
00211 <span class="preprocessor">        { NULL, NULL, NITF_TRE_DESC_NO_LENGTH } \</span>
00212 <span class="preprocessor">    }; \</span>
00213 <span class="preprocessor">    static nitf_TREDescriptionSet descriptionSet = { 0, descriptions }; \</span>
00214 <span class="preprocessor">    NITF_DECLARE_PLUGIN(_Tre)</span>
00215 <span class="preprocessor"></span>
00216 
00217 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Mar 1 13:51:10 2008 for NITF by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
